<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AltTalk TTS í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    textarea {
      width: 100%;
      font-size: 16px;
    }
    select, button {
      margin-top: 10px;
      padding: 6px 10px;
      font-size: 14px;
    }
    #status {
      margin-top: 20px;
      font-weight: bold;
    }
    a#download-link {
      display: inline-block;
      margin-top: 10px;
      color: #007bff;
      text-decoration: none;
    }
    a#download-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h2>AltTalk TTS í…ŒìŠ¤íŠ¸</h2>

  <textarea id="text" rows="5" placeholder="í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (10~500ì)"></textarea><br>

  <label for="voice">Voice ì„ íƒ:</label>
  <select id="voice">
    <option value="v_ULpLH4EoAu3jaMlqLDJx">Saki Asagiri (EN)</option>
    <option value="v_m93eDVq2VDtR7O7S9Txd">Kazutaka Yonekura</option>
    <option value="v_NOlDH8lKm7UYesLO40eL">Riho Shirogane</option>
    <option value="v_Qj3NsahAo1E6LBiqJuAr">Daisuke Murasame</option>
    <option value="v_4q339C9csbPv2hhElnC5">Rika Utagawa</option>
    <option value="v_80lzVQillsUC68PIrPop">Eiji Tsukihara</option>
  </select><br>

  <label for="lang">Language:</label>
  <select id="lang">
    <option value="en">English</option>
    <option value="ja" selected>Japanese</option>
  </select><br>

  <button onclick="speakText()">ì½ê¸°</button>

  <p id="status"></p>

  <script>
    function speakText() {
      const text = document.getElementById("text").value.trim();
      const voice = document.getElementById("voice").value;
      const language = document.getElementById("lang").value;
      const status = document.getElementById("status");

      if (text.length < 10 || text.length > 500) {
        alert("í…ìŠ¤íŠ¸ëŠ” 10ì ì´ìƒ, 500ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.");
        return;
      }

      status.textContent = "ì˜¤ë””ì˜¤ ìƒì„± ì¤‘...";
      const oldLink = document.getElementById("download-link");
      if (oldLink) oldLink.remove();

      fetch("https://tts-proxy-server.onrender.com/tts", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ text, voice_id: voice, language })
      })
      .then(response => {
        if (!response.ok) {
          throw new Error("TTS ìš”ì²­ ì‹¤íŒ¨");
        }
        return response.blob();
      })
      .then(blob => {
        const audioUrl = URL.createObjectURL(blob);
        const audio = new Audio(audioUrl);
        audio.play();
        status.textContent = "ğŸ§ ì¬ìƒ ì¤‘";

        // ğŸ”½ ë‹¤ìš´ë¡œë“œ ë§í¬ ë§Œë“¤ê¸°
        const downloadLink = document.createElement("a");
        downloadLink.href = audioUrl;
        downloadLink.download = "tts_output.mp3";
        downloadLink.id = "download-link";
        downloadLink.textContent = "ğŸ”½ ìŒì„± íŒŒì¼ ë‹¤ìš´ë¡œë“œ";
        status.appendChild(document.createElement("br"));
        status.appendChild(downloadLink);
      })
      .catch(error => {
        console.error("ì—ëŸ¬:", error);
        status.textContent = "ì˜¤ë¥˜ ë°œìƒ: " + error.message;
      });
    }
  </script>
</body>
</html>
